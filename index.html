<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI ‡§¶‡•Å‡§ï‡§æ‡§®‡§¶‡§æ‡§∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    .map-background {
      background-image: url('https://via.placeholder.com/300x200?text=Map+Placeholder');
      background-size: cover;
      background-position: center;
      position: absolute;
      inset: 0;
      opacity: 0.2;
      z-index: -1;
    }
    .login-background {
      background-color: #f5f5f5;
    }
  </style>
</head>
<body class="bg-gray-900 text-black">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [page, setPage] = useState('login');
      const [name, setName] = useState('');
      const [location, setLocation] = useState('‡§°‡§Æ‡•Ä ‡§≤‡•ã‡§ï‡•á‡§∂‡§®');
      const [chatHistory, setChatHistory] = useState([]);
      const [inputMessage, setInputMessage] = useState('');
      const [userPreferences, setUserPreferences] = useState({});
      const [language, setLanguage] = useState('hindi'); // Default to Hindi

      useEffect(() => {
        console.log('Page changed to:', page, 'Language:', language);
      }, [page, language]);

      const languageOptions = {
        hindi: {
          loginTitle: 'AI ‡§¶‡•Å‡§ï‡§æ‡§®‡§¶‡§æ‡§∞',
          loginText: '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§∏‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç',
          loginPlaceholder: '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞',
          loginButton: 'OTP ‡§≠‡•á‡§ú‡•á‡§Ç',
          profileTitle: 'AI ‡§¶‡•Å‡§ï‡§æ‡§®‡§¶‡§æ‡§∞',
          profileText: '‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
          profilePlaceholder: '‡§®‡§æ‡§Æ',
          profileButton: '‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç',
          confirmTitle: 'AI ‡§¶‡•Å‡§ï‡§æ‡§®‡§¶‡§æ‡§∞',
          confirmName: '(‡§®‡§æ‡§Æ)',
          confirmLocation: '‡§≤‡•ã‡§ï‡•á‡§∂‡§®',
          confirmButton: '‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç',
          chatTitle: 'AI ‡§¶‡•Å‡§ï‡§æ‡§®‡§¶‡§æ‡§∞',
          chatText: 'AI ‡§∏‡•á ‡§ö‡•à‡§ü‡§ø‡§Ç‡§ó ‡§ï‡§∞‡•á‡§Ç | ‡§ë‡§∞‡•ç‡§°‡§∞ #12345',
          chatPlaceholder: '‡§ï‡•ç‡§Ø‡§æ ‡§ñ‡§∞‡•Ä‡§¶‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?',
          chatButton: '‡§≠‡•á‡§ú‡•á‡§Ç',
          updateLocation: '‡§ï‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡§π‡•Ä ‡§π‡•à?',
          suggestions: '‡§∏‡•Å‡§ù‡§æ‡§µ',
          home: '‡§ò‡§∞',
          shop: '‡§¶‡•Å‡§ï‡§æ‡§®',
          chat: '‡§ö‡•à‡§ü',
          profile: '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
          defaultReply: '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡§§ ‡§¨‡§§‡§æ‡§è‡§Ç‡•§',
          errorReply: '‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§ú‡§µ‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§'
        },
        hinglish: {
          loginTitle: 'AI Dukandar',
          loginText: 'Mobile number se login karein',
          loginPlaceholder: 'Mobile number',
          loginButton: 'OTP bhejo',
          profileTitle: 'AI Dukandar',
          profileText: 'Apna naam daal do',
          profilePlaceholder: 'Naam',
          profileButton: 'Location track karo',
          confirmTitle: 'AI Dukandar',
          confirmName: '(Naam)',
          confirmLocation: 'Location',
          confirmButton: 'Lokeshan ki pushti karo',
          chatTitle: 'AI Dukandar',
          chatText: 'AI se chat karo | Order #12345',
          chatPlaceholder: 'Kya khareedna hai?',
          chatButton: 'Bhejo',
          updateLocation: 'Kya ye location sahi hai?',
          suggestions: 'Suggestions',
          home: 'Ghar',
          shop: 'Dukaan',
          chat: 'Chat',
          profile: 'Profile',
          defaultReply: 'Kripya apni zarurat batayein.',
          errorReply: 'Sorry, abhi koi jawab nahi mila. Baad mein try karein.'
        },
        english: {
          loginTitle: 'AI Shopkeeper',
          loginText: 'Login with mobile number',
          loginPlaceholder: 'Mobile number',
          loginButton: 'Send OTP',
          profileTitle: 'AI Shopkeeper',
          profileText: 'Enter your name',
          profilePlaceholder: 'Name',
          profileButton: 'Track Location',
          confirmTitle: 'AI Shopkeeper',
          confirmName: '(Name)',
          confirmLocation: 'Location',
          confirmButton: 'Confirm Location',
          chatTitle: 'AI Shopkeeper',
          chatText: 'Chat with AI | Order #12345',
          chatPlaceholder: 'What to buy?',
          chatButton: 'Send',
          updateLocation: 'Is this location correct?',
          suggestions: 'Suggestions',
          home: 'Home',
          shop: 'Shop',
          chat: 'Chat',
          profile: 'Profile',
          defaultReply: 'Please tell me your requirement.',
          errorReply: 'Sorry, no response available. Please try again later.'
        }
      };

      const lang = languageOptions[language];

      const handleLogin = () => setPage('profile');
      const handleNameSubmit = () => {
        if (name.trim()) {
          setPage('confirmLocation');
        }
      };
      const handleConfirmLocation = () => {
        setPage('chat'); // Default behavior, proceeds on click
      };
      const updateLocation = () => {
        setLocation('‡§Ö‡§¶‡•ç‡§Ø‡§§‡§® ‡§°‡§Æ‡•Ä ‡§≤‡•ã‡§ï‡•á‡§∂‡§®');
        console.log('Location updated, please confirm again');
        setPage('confirmLocation');
      };

      const getBackendResponse = async (message) => {
        try {
          const response = await fetch('https://ai-dukandar-mvp.vercel.app/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, language }),
          });
          const data = await response.json();
          let reply = data.reply || lang.defaultReply;
          // Hinglish detection and response if language is Hinglish
          if (language === 'hinglish' && message.toLowerCase().includes('rice')) reply = '1 kg rice available hai, order karna hai?';
          else if (language === 'hinglish' && message.toLowerCase().includes('dal')) reply = '500 gm dal available hai, order karna hai?';
          return reply;
        } catch (error) {
          console.error('Error fetching backend response:', error);
          return lang.errorReply;
        }
      };

      const handleSendMessage = async (e) => {
        e.preventDefault();
        if (inputMessage.trim()) {
          const newHistory = [...chatHistory, { sender: 'user', text: inputMessage }];
          setChatHistory(newHistory);

          const aiResponse = await getBackendResponse(inputMessage);
          setChatHistory([...newHistory, { sender: 'ai', text: aiResponse }]);
          setInputMessage('');
        }
      };

      const getSuggestions = () => {
        const prefs = Object.entries(userPreferences)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 2)
          .map(([item]) => (item === 'rice' ? (language === 'hinglish' ? '1 kg rice' : language === 'english' ? '1 kg rice' : '1 ‡§ï‡§ø‡§≤‡•ã ‡§ö‡§æ‡§µ‡§≤') : (language === 'hinglish' ? '500 gm dal' : language === 'english' ? '500 gm dal' : '500 ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§¶‡§æ‡§≤')));
        return prefs.length ? prefs.join(', ') : (language === 'hinglish' ? '1 kg rice, 500 gm dal' : language === 'english' ? '1 kg rice, 500 gm dal' : '1 ‡§ï‡§ø‡§≤‡•ã ‡§ö‡§æ‡§µ‡§≤, 500 ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§¶‡§æ‡§≤');
      };

      const changeLanguage = (newLanguage) => {
        setLanguage(newLanguage);
        setChatHistory([]); // Clear chat on language change
      };

      const navigateTo = (targetPage) => setPage(targetPage);

      return (
        <div className="min-h-screen flex flex-col items-center justify-between p-4">
          <div className="w-full max-w-md">
            {page === 'login' && (
              <div className="bg-green-600 p-4 rounded-t-lg shadow-lg text-center login-background relative">
                <h1 className="text-2xl mb-4 text-white">{lang.loginTitle}</h1>
                <p className="mb-4 text-white">{lang.loginText}</p>
                <input
                  type="text"
                  placeholder={lang.loginPlaceholder}
                  className="p-2 mb-4 rounded w-full text-black"
                />
                <button
                  onClick={handleLogin}
                  className="bg-green-700 text-white px-4 py-2 rounded w-full hover:bg-green-800"
                >
                  {lang.loginButton}
                </button>
                <div className="mt-2">
                  <button onClick={() => changeLanguage('hindi')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                  <button onClick={() => changeLanguage('hinglish')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">Hinglish</button>
                  <button onClick={() => changeLanguage('english')} className="bg-gray-500 text-white px-2 py-1 rounded">English</button>
                </div>
                <div className="map-background"></div>
              </div>
            )}
            {page === 'profile' && (
              <div className="bg-green-600 p-4 rounded-t-lg shadow-lg text-center w-full max-w-md relative">
                <h1 className="text-2xl mb-4 text-white">{lang.profileTitle}</h1>
                <p className="mb-4 text-white">{lang.profileText}</p>
                <div className="space-y-4">
                  <input
                    type="text"
                    value={name}
                    onChange={(e) => setName(e.target.value)}
                    placeholder={lang.profilePlaceholder}
                    className="p-2 rounded text-black w-full z-10"
                    required
                  />
                  <button
                    onClick={handleNameSubmit}
                    className="bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800 w-full z-10"
                  >
                    {lang.profileButton}
                  </button>
                </div>
                <div className="mt-2">
                  <button onClick={() => changeLanguage('hindi')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                  <button onClick={() => changeLanguage('hinglish')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">Hinglish</button>
                  <button onClick={() => changeLanguage('english')} className="bg-gray-500 text-white px-2 py-1 rounded">English</button>
                </div>
                <div className="map-background"></div>
              </div>
            )}
            {page === 'confirmLocation' && (
              <div className="bg-green-600 p-4 rounded-t-lg shadow-lg text-center w-full max-w-md relative">
                <h1 className="text-2xl mb-4 text-white">{lang.confirmTitle}</h1>
                <p className="mb-4 text-white">{name} {lang.confirmName}</p>
                <p className="mb-4 text-white">{lang.confirmLocation}: {location}</p>
                <button
                  onClick={handleConfirmLocation}
                  className="bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800 w-full z-10"
                >
                  {lang.confirmButton}
                </button>
                <div className="mt-2">
                  <button onClick={() => changeLanguage('hindi')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                  <button onClick={() => changeLanguage('hinglish')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">Hinglish</button>
                  <button onClick={() => changeLanguage('english')} className="bg-gray-500 text-white px-2 py-1 rounded">English</button>
                </div>
                <div className="map-background"></div>
              </div>
            )}
            {page === 'chat' && (
              <div className="bg-green-600 p-4 rounded-t-lg shadow-lg text-center w-full max-w-md relative">
                <h1 className="text-2xl mb-4 text-white">{lang.chatTitle}</h1>
                <p className="mb-4 text-white">{lang.chatText}</p>
                <div className="mb-4 h-48 overflow-y-auto bg-white text-black p-2 rounded">
                  {chatHistory.map((msg, index) => (
                    <p key={index} className={msg.sender === 'user' ? 'text-right' : 'text-left'}>
                      {msg.text}
                    </p>
                  ))}
                </div>
                <form onSubmit={handleSendMessage} className="space-y-2">
                  <input
                    type="text"
                    value={inputMessage}
                    onChange={(e) => setInputMessage(e.target.value)}
                    placeholder={lang.chatPlaceholder}
                    className="p-2 rounded text-black w-full"
                  />
                  <button
                    type="submit"
                    className="bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800 w-full"
                  >
                    {lang.chatButton}
                  </button>
                </form>
                <button
                  onClick={updateLocation}
                  className="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800 w-full mt-2"
                >
                  {lang.updateLocation}
                </button>
                <p className="text-sm mt-2 text-white">{lang.suggestions}: {getSuggestions()}</p>
                <div className="mt-2">
                  <button onClick={() => changeLanguage('hindi')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                  <button onClick={() => changeLanguage('hinglish')} className="bg-gray-500 text-white px-2 py-1 rounded mr-1">Hinglish</button>
                  <button onClick={() => changeLanguage('english')} className="bg-gray-500 text-white px-2 py-1 rounded">English</button>
                </div>
                <div className="map-background"></div>
              </div>
            )}
          </div>
          <div className="flex justify-around w-full max-w-md p-2 bg-white text-black rounded-b-lg">
            <button onClick={() => navigateTo('home')} className="p-2">
              <span role="img" aria-label="home">üè†</span> {lang.home}
            </button>
            <button onClick={() => navigateTo('shop')} className="p-2">
              <span role="img" aria-label="shop">üõí</span> {lang.shop}
            </button>
            <button onClick={() => navigateTo('chat')} className="p-2">
              <span role="img" aria-label="chat">üí¨</span> {lang.chat}
            </button>
            <button onClick={() => navigateTo('profile')} className="p-2">
              <span role="img" aria-label="profile">üë§</span> {lang.profile}
            </button>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>